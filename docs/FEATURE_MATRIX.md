# Feature Matrix

Every option lists default, where it is read, what it changes in the pipeline, and interactions. See [docs/PIPELINE_OVERVIEW.md](PIPELINE_OVERVIEW.md) for stage ordering.

| Option | Default | Source | What it changes | Interactions/Notes |
| --- | --- | --- | --- | --- |
| `FIN_REPORT_PDF` env | unset | [src/pdf_to_markdown_docling/cli.py#L181-L191](src/pdf_to_markdown_docling/cli.py#L181-L191) | Supplies input PDF when positional is omitted. | Overrides need for positional `input`; loaded from `.env` via [_load_dotenv_into_environ](src/pdf_to_markdown_docling/cli.py#L163-L170). |
| Positional `input` | required unless env present | [src/pdf_to_markdown_docling/cli.py#L61-L108](src/pdf_to_markdown_docling/cli.py#L61-L108) | Path to PDF passed into `convert_pdf_to_markdown`. | Must exist or CLI exits. |
| `--output` | `<input>.md` | [src/pdf_to_markdown_docling/cli.py#L34-L48](src/pdf_to_markdown_docling/cli.py#L34-L48) | Target Markdown path resolved before conversion. | If dir provided, file named after input stem. |
| `--image-mode` | `placeholder` | [src/pdf_to_markdown_docling/cli.py#L69-L82](src/pdf_to_markdown_docling/cli.py#L69-L82) | Determines Docling image export mode and whether images are generated in [build_pdf_pipeline_options](src/pdf_to_markdown_docling/conversion_utils.py#L133-L168). | When `referenced`, `images_dir` auto-creates sibling assets folder if missing ([src/pdf_to_markdown_docling/cli.py#L197-L208](src/pdf_to_markdown_docling/cli.py#L197-L208)). |
| `--images-dir` | None | [src/pdf_to_markdown_docling/cli.py#L83-L87](src/pdf_to_markdown_docling/cli.py#L83-L87) | Destination for extracted images when `image-mode=referenced`. | Ignored for placeholder/embedded. |
| `--max-pages` | None | [src/pdf_to_markdown_docling/cli.py#L88-L92](src/pdf_to_markdown_docling/cli.py#L88-L92) | Limits pages processed by Docling in [convert_pdf_to_doc](src/pdf_to_markdown_docling/conversion_utils.py#L305-L334). | Mutually exclusive with `--page-range` semantics only via Docling; no explicit guard. |
| `--page-range` | None | [src/pdf_to_markdown_docling/cli.py#L93-L101](src/pdf_to_markdown_docling/cli.py#L93-L101) | Restricts pages converted; parsed by [parse_page_range](src/pdf_to_markdown_docling/cli.py#L19-L33). | Input validated to 1-based inclusive; cannot combine with `max-pages` enforcement beyond Docling. |
| `--ocr` | `False` | [src/pdf_to_markdown_docling/cli.py#L102-L118](src/pdf_to_markdown_docling/cli.py#L102-L118) & [src/pdf_to_markdown_docling/cli.py#L210-L213](src/pdf_to_markdown_docling/cli.py#L210-L213) | Forces `ocr_mode` to `on` before conversion. | Overrides `--ocr-mode`; pairs with `--force-full-page-ocr`. |
| `--ocr-mode` | `off` | [src/pdf_to_markdown_docling/cli.py#L102-L118](src/pdf_to_markdown_docling/cli.py#L102-L118) | Controls whether Docling runs OCR: `on`, `off`, or `auto` (auto may rerun with OCR in [convert_pdf_to_doc](src/pdf_to_markdown_docling/conversion_utils.py#L334-L378)). | `--ocr` sets this to `on`; `auto` uses spacing/char thresholds to trigger OCR retry. |
| `--ocr-engine` | `tesseract` | [src/pdf_to_markdown_docling/cli.py#L119-L133](src/pdf_to_markdown_docling/cli.py#L119-L133) | Selects OCR backend, mapped to Docling options in [build_ocr_options](src/pdf_to_markdown_docling/conversion_utils.py#L119-L132). | Used only when OCR enabled (`ocr_mode on/auto` and triggered). |
| `--ocr-lang` | `eng` | [src/pdf_to_markdown_docling/cli.py#L134-L138](src/pdf_to_markdown_docling/cli.py#L134-L138) | Language list for OCR; normalized in [parse_ocr_langs](src/pdf_to_markdown_docling/conversion_utils.py#L113-L118). | Shared by Docling OCR and picture KPI OCR when enabled. |
| `--force-full-page-ocr` | `False` | [src/pdf_to_markdown_docling/cli.py#L139-L143](src/pdf_to_markdown_docling/cli.py#L139-L143) | Forces page-level OCR in Docling pipeline via [build_ocr_options](src/pdf_to_markdown_docling/conversion_utils.py#L119-L132). | Effective only when OCR is on/auto and triggered. |
| `--spacing-fix` | `pymupdf` | [src/pdf_to_markdown_docling/cli.py#L144-L166](src/pdf_to_markdown_docling/cli.py#L144-L166) with remapping in [src/pdf_to_markdown_docling/cli.py#L214-L218](src/pdf_to_markdown_docling/cli.py#L214-L218) | Chooses spacing repair strategy in [convert_pdf_to_doc](src/pdf_to_markdown_docling/conversion_utils.py#L378-L457): PyMuPDF glyphs (`pymupdf`/`heuristic`), Docling word cells (`docling`), or OCR hybrid (`ocr`). | `--fix-spaced-tables` flips `spacing-fix` from `off` to `ocr` if set ([src/pdf_to_markdown_docling/cli.py#L214-L218](src/pdf_to_markdown_docling/cli.py#L214-L218)); spacing fixes skipped if mode `off`. |
| `--fix-spaced-tables` | `False` | [src/pdf_to_markdown_docling/cli.py#L144-L166](src/pdf_to_markdown_docling/cli.py#L144-L166) | Deprecated alias that only acts when `spacing-fix off`, remapping to OCR table repair in [src/pdf_to_markdown_docling/cli.py#L214-L218](src/pdf_to_markdown_docling/cli.py#L214-L218). | No effect if `spacing-fix` already non-off. |
| `--pdf-backend` | `auto` | [src/pdf_to_markdown_docling/cli.py#L109-L125](src/pdf_to_markdown_docling/cli.py#L109-L125) | Chooses Docling backend: direct bind or auto-probe in [select_backend_auto](src/pdf_to_markdown_docling/conversion_utils.py#L205-L229). | Auto incurs extra single-page converts for scoring. |
| `--device` | `cuda` | [src/pdf_to_markdown_docling/cli.py#L126-L132](src/pdf_to_markdown_docling/cli.py#L126-L132) | Sets accelerator for Docling pipeline via [build_pdf_pipeline_options](src/pdf_to_markdown_docling/conversion_utils.py#L133-L168). | Accepts `auto/cpu/mps/cuda[:N]`; affects performance only. |
| `--quiet` | `False` | [src/pdf_to_markdown_docling/cli.py#L148-L153](src/pdf_to_markdown_docling/cli.py#L148-L153) | Lowers logging verbosity used across pipeline prints. | Propagated to backend auto-probe summaries and spacing-fix logs in [convert_pdf_to_doc](src/pdf_to_markdown_docling/conversion_utils.py#L205-L506). |
| `--audit` | `False` | [src/pdf_to_markdown_docling/cli.py#L154-L159](src/pdf_to_markdown_docling/cli.py#L154-L159) | Runs Markdown fidelity audit after conversion using [audit_doc_vs_markdown](src/pdf_to_markdown_docling/audit_utils.py#L272-L334) in [src/pdf_to_markdown_docling/cli.py#L244-L271](src/pdf_to_markdown_docling/cli.py#L244-L271). | No pipeline mutation; prints stats only. |
| `--export-json` | None | [src/pdf_to_markdown_docling/cli.py#L160-L162](src/pdf_to_markdown_docling/cli.py#L160-L162) | Writes Docling JSON via [save_docling_json](src/pdf_to_markdown_docling/export_utils.py#L31-L43). | Uses export path resolver [src/pdf_to_markdown_docling/cli.py#L49-L60](src/pdf_to_markdown_docling/cli.py#L49-L60). |
| `KPI_OCR` env | `True` (parsed) | [src/pdf_to_markdown_docling/conversion_utils.py#L73-L118](src/pdf_to_markdown_docling/conversion_utils.py#L73-L118) | Gates picture KPI caption OCR in [add_picture_kpi_captions](src/pdf_to_markdown_docling/picture_kpi_extract.py#L196-L279) triggered from [convert_pdf_to_doc](src/pdf_to_markdown_docling/conversion_utils.py#L485-L506). | Loaded from environment or `.env`; `_parse_bool` defaults to True. |
| Audit script flags | see defaults in parser | [scripts/audit_pdf_vs_md.py#L17-L103](scripts/audit_pdf_vs_md.py#L17-L103) | Re-run conversion for auditing only, honoring pdf-backend/OCR/spacing options before scoring via [audit_doc_vs_markdown](src/pdf_to_markdown_docling/audit_utils.py#L272-L334). | Same remapping for `--ocr` and `--spacing-fix` as CLI ([scripts/audit_pdf_vs_md.py#L65-L83](scripts/audit_pdf_vs_md.py#L65-L83)). |
| Quality script `input` | n/a | [scripts/quality_report.py#L13-L31](scripts/quality_report.py#L13-L31) | Scores Markdown text via [score_markdown](src/pdf_to_markdown_docling/quality.py#L17-L55). | No pipeline impact; analysis only. |

## Key combinations

| Scenario | Conditions | Resulting branch/stages |
| --- | --- | --- |
| Docling backend auto (default) | `--pdf-backend auto` | Auto-probes both backends then runs selected backend through stages 2â€“12 in [convert_pdf_to_doc](src/pdf_to_markdown_docling/conversion_utils.py#L205-L506). |
| Force pypdfium2 | `--pdf-backend pypdfium2` | Skips probing and binds PyPdfium backend for conversion in [convert_pdf_to_doc](src/pdf_to_markdown_docling/conversion_utils.py#L305-L334). |
| Force docling-parse-v4 | `--pdf-backend docling-parse-v4` | Uses DoclingParseV4 backend directly in [convert_pdf_to_doc](src/pdf_to_markdown_docling/conversion_utils.py#L305-L334). |
| OCR always on | `--ocr` or `--ocr-mode on` | Single conversion with OCR enabled and cell matching in [convert_pdf_to_doc](src/pdf_to_markdown_docling/conversion_utils.py#L305-L334). |
| OCR auto retry | `--ocr-mode auto` (default with `--ocr` absent) | First pass without OCR; triggers OCR rerun when chars/page <200 or spaced table ratio >=0.04 in [convert_pdf_to_doc](src/pdf_to_markdown_docling/conversion_utils.py#L334-L378). |
| Spacing fix: PyMuPDF | `--spacing-fix pymupdf` or `heuristic` | Page-targeted glyph reconstruction in [fix_spaced_items_with_pymupdf_glyphs](src/pdf_to_markdown_docling/pymupdf_spacing_fix.py#L365-L509) invoked from [convert_pdf_to_doc](src/pdf_to_markdown_docling/conversion_utils.py#L378-L457). |
| Spacing fix: Docling cells | `--spacing-fix docling` | Uses Docling word/char cells for repair via [fix_spaced_items_with_word_cells](src/pdf_to_markdown_docling/spacing_fix.py#L221-L305). |
| Spacing fix: OCR hybrid | `--spacing-fix ocr` or `--fix-spaced-tables` with `spacing-fix off` | Builds OCR table doc and merges spaced cells via [merge_spaced_table_cells](src/pdf_to_markdown_docling/table_fixes.py#L785-L855) before PyMuPDF/Docling spacing repair. |
| Table currency/header cleanup | Always on | Runs after spacing repair in [convert_pdf_to_doc](src/pdf_to_markdown_docling/conversion_utils.py#L485-L506) using [table_fixes](src/pdf_to_markdown_docling/table_fixes.py#L415-L809). |
| KPI OCR captions | `KPI_OCR` true (default) | Extracts picture KPIs via [add_picture_kpi_captions](src/pdf_to_markdown_docling/picture_kpi_extract.py#L196-L279). Set env false to skip. |
| Chunking/page_chunks | UNKNOWN | No CLI/env flags found; searched for "chunk" in src/** (only marker helpers in [export_utils](src/pdf_to_markdown_docling/export_utils.py#L44-L72) and [audit_utils](src/pdf_to_markdown_docling/audit_utils.py#L336-L345)). |
| PyMuPDF4LLM | UNKNOWN | Engine not present; searched for "PyMuPDF4LLM" in src/**. |

Use this matrix alongside [docs/PIPELINE_OVERVIEW.md](PIPELINE_OVERVIEW.md) for stage-by-stage effects.
